@{
    ViewData["Title"] = "Member Profile";
    var profile = ViewBag.Profile;
    var currentBorrowings = ViewBag.CurrentBorrowings as dynamic[];
    var borrowHistory = ViewBag.BorrowHistory as dynamic[];
    var totalFines = ViewBag.TotalFines;
    var success = ViewBag.Success as bool?;
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<div class="container py-4">
    <div class="mb-3">
        <a href="/Member/Index" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="card text-center mb-4">
                <div class="card-body">
                    <img src="@profile.ProfileImage" class="rounded-circle mb-3" style="width:120px;height:120px;object-fit:cover;" alt="Profile" />
                    <h4 class="fw-bold">@profile.FullName</h4>
                    <div class="text-muted">@profile.Email</div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="fw-bold"><i class="fas fa-user-edit"></i> Profile Info</span>
                    <button id="editBtn" class="btn btn-outline-primary btn-sm" onclick="enableEdit()"><i class="fas fa-edit"></i> Edit Profile</button>
                </div>
                <div class="card-body">
                    @if (success == true)
                    {
                        <div class="alert alert-success">Profile updated successfully.</div>
                    }
                    <form method="post" enctype="multipart/form-data" id="profileForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" name="fullName" class="form-control" value="@profile.FullName" disabled />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" name="email" class="form-control" value="@profile.Email" disabled />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" name="password" class="form-control" value="" placeholder="Change Password" disabled />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Profile Image</label>
                            <input type="file" name="profileImage" class="form-control" disabled />
                        </div>
                        <button type="submit" class="btn btn-success" id="saveBtn" style="display:none;"><i class="fas fa-save"></i> Save Changes</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header fw-bold"><i class="fas fa-book"></i> Borrowing Info</div>
                <div class="card-body">
                    <div class="mb-3">
                        <span class="fw-semibold">Total Outstanding Fines: </span>
                        <span class="badge bg-danger">@totalFines BDT</span>
                    </div>
                    <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="current-tab" data-bs-toggle="tab" data-bs-target="#current" type="button" role="tab">Current Borrowings</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">Borrowing History</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3">
                        <div class="tab-pane fade show active" id="current" role="tabpanel">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var b in currentBorrowings)
                                    {
                                        <tr>
                                            <td>@b.Title</td>
                                            <td>@b.DueDate.ToString("yyyy-MM-dd")</td>
                                            <td><span class="badge @(b.Status == "Overdue" ? "bg-danger" : "bg-success")">@b.Status</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="tab-pane fade" id="history" role="tabpanel">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Borrow Date</th>
                                        <th>Return Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var h in borrowHistory)
                                    {
                                        <tr>
                                            <td>@h.Title</td>
                                            <td>@h.BorrowDate.ToString("yyyy-MM-dd")</td>
                                            <td>@h.ReturnDate.ToString("yyyy-MM-dd")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function enableEdit() {
        document.querySelectorAll('#profileForm input').forEach(e => e.disabled = false);
        document.getElementById('saveBtn').style.display = '';
        document.getElementById('editBtn').style.display = 'none';
    }
</script> 